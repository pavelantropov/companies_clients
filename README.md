# C# тестовое задание

## Задача
Неободимо разработать веб сервис. Использовать: C#, ASP.NET Core 7, SQLite.

После разработки объяснить свои решения и код. Предложить улучшения и правки.


## Описание
Есть компании, которые сохраняют или получают данные о своих клиентах. Необходимо разработать веб сервис, который позволяет это делать.

Данные передаются по REST API в JSON формате.

Компания может передавать данные уже сохраненных в БД сервиса клиентов. В таком случаи, если есть изменения, необходимо обновлять данные в БД.

Не смотря на простоту задачи - проект будет использоваться на проде, при разработке необходимо это учитывать, тоесть предусмотреть тестирование, логгирование, развертывание, оповещения, или хотябы внести свои предложения.

Приблизительная нагрузка при сохранении данных: 1000 компаний, каждая из которых раз в 15 минут (время у каждой компании разное) отправляет данные 100 клиентов.

Приблизительная нагрузка при получении данных: 1000 компаний, каждая из которых раз в 5 минут пытаются найти своего клиента/клиентов.


## База данных
На проде используется MySQL 5.7, при выполнении ТЗ использовать SQLite.

БД состоит из двух таблиц - таблица компаний и клиентов.

Названия таблиц и полей необходимо сохранить.

### Таблица компаний
**Название:** `common_companies`

**Описание:** Содержит данные о компаниях. Данные заполняются вручную.

**Поля:**
* `id` - ИД. Целое число.
* `name` - Название
* `cid` - Хэш для авторизации. MD5.
* `timezone` - Таймзона. Число.
* `phone` - Телефон
* `address` - Адрес
* `created_at` - Дата\время создания записи в таблице
* `updated_at` - Дата\время последней модификации записи в таблице
* `removed_at` - Дата\время логического удаления компании

### Таблица клиентов
**Название:** `data_clients`

**Описание:** Содержит данные о клиентах компании. Данные заполняются чере АПИ.

**Поля:**
* `id` - ИД в БД. GUID.
* `client_id` - ИД во внутренней БД компании. Целое число.
* `company_id` - ИД компании.
* `card` - Тестовый ИД в БД компании. NULL.
* `surname` - Фамилия.
* `firstname` - Имя.
* `middlename` - Отчество. NULL.
* `phone` - Телефон. NULL.
* `email` - Адрес. NULL.
* `gender` - Пол. NULL.
* `birthday` - Дата рождения. NULL.
* `notes` - Дополнительные заметки. NULL.
* `crm_created_at` - Дата\время создания записи о клиенте во внетренней БД компании.
* `crm_updated_at` - Дата\время последнего изменения записи о клиенте во внетренней БД компании.
* `crm_removed_at` - Дата\время логического удаления записи о клиенте во внетренней БД компании.  NULL.
* `created_at` - Дата\время создания записи в БД.
* `updated_at` - Дата\время последнего изменения записи в БД.


## АПИ

### Дата и время
Все поля типа дата\время передаются в UTC.

### Авторизация
Авторизация каждого запроса происходит путем передачи HTTP заголовка `Zabota-Auth` со значением, равным `CID компании`, от имени которой должны быть загружены данные. Например: `Zabota-Auth: TestCID`. `CID` хранится в БД, в таблице компаний.

### Методы
Названия методов и полей - сохранить. Ответы сервера - сохранить.

**Сохранение данных**

**Путь:** /clients

**Метод:** POST

**Данные:**
```
"data": [
	{
		"id": 1,
		"card": "123",
		"surname": "Иванов",
		"firstname": "Иван",
		"middlename": "Иванович",
		"phone": "112",
		"email": "test@email.com",
		"gender": 0,
		"birthday": "2022-03-18",
		"notes": "Notes",
		"created_at": "2022-03-18T11:32:12.873Z",
		"updated_at": "2022-03-18T11:32:12.873Z",
		"removed_at": "2022-03-18T11:32:12.873Z"
	}
]
```
**Ответы:**
* 200 - Успешный запрос
```
{
	"state": "success"
}
```

* 400 - Ошибка запроса.
```
{
	"state": "error",
	"error": {
		"code": 1,
		"message": "Wrong ID parameter.",
		"info": "ID parameter is required!"
	}
}
```

* 401 - Ошибка авторизации.
* 403 - Доступ запрещен.
* 404 - Ресурс не найден.
* 413 - Слишком большое тело запроса.
* 500 - Ошибка сервера.

**Получение данных**

**Путь:** /clients

**Метод:** GET

**Параметры:**

Необходимо иметь возможность найти клиента (клиентов) по полям:
* `card` - полное совпадение
* `surname` - подстрока
* `firstname` - подстрока
* `middlename` - подстрока
* `phone` - полное совпадение
* `email` - полное совпадение
* `birthday` - полное совпадение

Параметры передаются в URL, поиск происходит по одному или сразу нескольким параметрас.
Если нет параметров - ошибка.
Пагинация не нужна.
**Ответы:**
* 200 - Успешный запрос
```
{
	"state": "success",
	"total": 1,
	"clients": [
		{
			"id": 1,
			"card": "123",
			"surname": "Иванов",
			"firstname": "Иван",
			"middlename": "Иванович",
			"phone": "112",
			"email": "test@email.com",
			"gender": 0,
			"birthday": "2022-03-18",
			"notes": "Notes",
			"created_at": "2022-03-18T11:32:12.873Z",
			"updated_at": "2022-03-18T11:32:12.873Z",
			"removed_at": "2022-03-18T11:32:12.873Z"
		}
	]
}
```

* 400 - Ошибка запроса.
```
{
	"state": "error",
	"error": {
		"code": 1,
		"message": "Wrong ID parameter.",
		"info": "ID parameter is required!"
	}
}
```

* 401 - Ошибка авторизации.
* 403 - Доступ запрещен.
* 404 - Ресурс не найден.
* 413 - Слишком большое тело запроса.
* 500 - Ошибка сервера.
